@page "/profil"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@layout Arcade.Components.Layout.MainLayout

@using Microsoft.AspNetCore.Components.Authorization
@inject IJSRuntime JS
@inject NavigationManager Nav

<h3>Dein Profil</h3>

<p>Hi <b>@UserName</b> 👋</p>

<button class="auth__submit" @onclick="Logout">Logout</button>

@code {
    [CascadingParameter]
    private Task<AuthenticationState>? AuthStateTask { get; set; }

    string UserName = "Spieler";

    protected override async Task OnInitializedAsync()
    {
        var auth = await AuthStateTask!;
        if (auth.User.Identity?.IsAuthenticated == true)
            UserName = auth.User.Identity!.Name!;
        else
            Nav.NavigateTo("/anmelden", true);
    }

    async Task Logout()
    {
        await JS.InvokeVoidAsync("arcadeAuth.logout");
        Nav.NavigateTo("/", true);
    }
}
